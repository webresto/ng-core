!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http"),require("ngx-store")):"function"==typeof define&&define.amd?define("@webresto/ng-core",["exports","@angular/core","rxjs","rxjs/operators","@angular/common/http","ngx-store"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).webresto=e.webresto||{},e.webresto["ng-core"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common.http,e.i1$2)}(this,(function(e,t,r,o,n,i){"use strict";var s=function(e,t,r){this.type=e,this.title=t,this.body=r},c=function(){function e(){this.eventMessage=new t.EventEmitter,this.eventAction=new t.EventEmitter}return e.prototype.emitMessageEvent=function(e){this.eventMessage.emit(e)},e.prototype.emitActionEvent=function(e){this.eventAction.emit(e)},e.prototype.getMessageEmitter=function(){return this.eventMessage},e.prototype.getActionEmitter=function(){return this.eventAction},e}();c.ɵfac=function(e){return new(e||c)},c.ɵprov=t.ɵɵdefineInjectable({token:c,factory:c.ɵfac,providedIn:"root"});var a=function(){this.maintenance$=new r.BehaviorSubject(null)};a.ɵfac=function(e){return new(e||a)},a.ɵprov=t.ɵɵdefineInjectable({token:a,factory:a.ɵfac,providedIn:"root"});var u=function(e){var t=this;this.port=80,this.prefix="api/",this.versionModule="0.5",e.subscribe((function(e){t.url=e}))};u.ɵfac=function(e){return new(e||u)(t.ɵɵinject("ApiDomain"))},u.ɵprov=t.ɵɵdefineInjectable({token:u,factory:u.ɵfac,providedIn:"root"});var f=function(){function e(e,t){this.http=e,this.config=t}return e.prototype.get=function(e,t){return void 0===t&&(t=!0),e=t?this.config.url+this.config.prefix+this.config.versionModule+e:this.config.url+e,this.http.get(e).pipe(o.retry(3))},e.prototype.put=function(e,t,r){return void 0===r&&(r=!0),e=r?this.config.url+this.config.prefix+this.config.versionModule+e:this.config.url+e,this.http.put(e,t)},e.prototype.post=function(e,t,r){return void 0===r&&(r=!0),e=r?this.config.url+this.config.prefix+this.config.versionModule+e:this.config.url+e,this.http.post(e,t)},e}();f.ɵfac=function(e){return new(e||f)(t.ɵɵinject(n.HttpClient),t.ɵɵinject(u))},f.ɵprov=t.ɵɵdefineInjectable({token:f,factory:f.ɵfac,providedIn:"root"});var d=function(){function e(e,t,o){this.cookiesStorageService=e,this.localStorageService=t,this.sharedStorageService=o,this.initTypeStorage(),this.event=new r.BehaviorSubject({})}return e.prototype.initTypeStorage=function(){},e.prototype.get=function(e,t){return this[e].get(t)},e.prototype.set=function(e,t,r){return this[e].set(t,r)},e.prototype.sub=function(e,t){var r=this;return this[e].observe().subscribe((function(e){e.key==t&&r.event.next({changeKey:t})})),this.event},e}();d.ɵfac=function(e){return new(e||d)(t.ɵɵinject(i.CookiesStorageService),t.ɵɵinject(i.LocalStorageService),t.ɵɵinject(i.SharedStorageService))},d.ɵprov=t.ɵɵdefineInjectable({token:d,factory:d.ɵfac,providedIn:"root"});var p=function(){};p.ɵmod=t.ɵɵdefineNgModule({type:p}),p.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||p)},providers:[],imports:[[]]});var v=function(){function e(e,t){this.eventer=e,this.state=t}return e.prototype.intercept=function(e,t){var r=this;return t.handle(e).pipe(o.map((function(e){var t,o,i,c,a,u,f;if(e instanceof n.HttpResponse&&(null===(t=e.body)||void 0===t?void 0:t.enable)&&void 0!==e.body.title&&void 0!==e.body.description&&void 0!==e.body.startDate&&void 0!==e.body.stopDate){var d=(new Date).getTime(),p=new Date(e.body.startDate).getTime(),v=new Date(e.body.stopDate).getTime();d>p&&d<v&&r.state.maintenance$.next({title:e.body.title,description:e.body.description})}else e instanceof n.HttpResponse&&(null===(i=null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.message)||void 0===i?void 0:i.body)&&(null===(a=null===(c=null==e?void 0:e.body)||void 0===c?void 0:c.message)||void 0===a?void 0:a.title)&&(null===(f=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.message)||void 0===f?void 0:f.type)&&r.eventer.emitMessageEvent(new s(e.body.message.type,e.body.message.title,e.body.message.body));return e})))},e}();v.ɵfac=function(e){return new(e||v)(t.ɵɵinject(c),t.ɵɵinject(a))},v.ɵprov=t.ɵɵdefineInjectable({token:v,factory:v.ɵfac});var l=function(){function e(e,t){this.eventer=e,this.state=t}return e.prototype.intercept=function(e,t){return t.handle(e).pipe(o.tap((function(e){if(e instanceof n.HttpResponse&&e.body.status&&e.body.message&&e.body.message[0])throw new Error(e.body.message[0])})),o.catchError(this.handleError.bind(this)))},e.prototype.handleError=function(e){if(e.error.enable&&void 0!==e.error.title&&void 0!==e.error.description&&void 0!==e.error.startDate&&void 0!==e.error.stopDate){var t=(new Date).getTime(),o=new Date(e.error.startDate).getTime(),n=new Date(e.error.stopDate).getTime();return t>o&&t<n&&this.state.maintenance$.next({title:e.error.title,description:e.error.description,social:e.error.social}),r.throwError(e.error)}if(e.error instanceof ErrorEvent)console.error("An error occurred:",e.error.message);else if(e instanceof Error)switch(console.error("An error occurred:",e.message),e.message){case"timeout-or-duplicate":return r.throwError("Ошибка сервера (таймаут). Повторите попытку позже")}else{if(console.error("Backend returned code "+e.status+", body was: "+e.error),401==e.status)return this.eventer.emitMessageEvent(new s("Unauthorized","","")),r.throwError(e.error&&e.error.title?e.error.title:"Необходимо пройти авторизацию");(400==e.status||500==e.status)&&e.error&&e.error.message&&e.error.message.title&&e.error.message.body&&this.eventer.emitMessageEvent(new s("error",e.error.message.title,e.error.message.body))}return r.throwError(e.error)},e}();l.ɵfac=function(e){return new(e||l)(t.ɵɵinject(c),t.ɵɵinject(a))},l.ɵprov=t.ɵɵdefineInjectable({token:l,factory:l.ɵfac});var h=function(){function e(){}return e.prototype.intercept=function(e,t){console.info("AuthInterceptor",e);var r=localStorage.getItem("gf:tkn:v2");if(r){var o=e.clone({headers:e.headers.set("Authorization","JWT "+r)});return t.handle(o)}return t.handle(e)},e}();h.ɵfac=function(e){return new(e||h)},h.ɵprov=t.ɵɵdefineInjectable({token:h,factory:h.ɵfac}),e.AuthInterceptor=h,e.EventMessage=s,e.EventerService=c,e.MessageInterceptor=v,e.NetService=f,e.NgCoreModule=p,e.RestoStorageService=d,e.ServerErrorInterceptor=l,e.StateService=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=webresto-ng-core.umd.min.js.map