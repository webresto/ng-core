!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common/http"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@webresto/ng-core",["exports","@angular/core","rxjs","@angular/common/http","rxjs/operators"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@webresto/ng-core"]={},e.ng.core,e.rxjs,e.ng.common.http,e.rxjs.operators)}(this,(function(e,t,o,r,n){"use strict";var i=function(e,t,o){this.type=e,this.title=t,this.body=o},s=function(){function e(){this.eventMessage=new t.EventEmitter,this.eventAction=new t.EventEmitter}return e.prototype.emitMessageEvent=function(e){this.eventMessage.emit(e)},e.prototype.emitActionEvent=function(e){this.eventAction.emit(e)},e.prototype.getMessageEmitter=function(){return this.eventMessage},e.prototype.getActionEmitter=function(){return this.eventAction},e}();s.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new s},token:s,providedIn:"root"}),s.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[]};var l=function(){this.maintenance$=new o.BehaviorSubject(null)};l.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new l},token:l,providedIn:"root"}),l.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],l.ctorParameters=function(){return[]};var d=function(e){var t=this;this.port=80,this.prefix="api/",this.versionModule="0.5",e.subscribe((function(e){t.url=e}))};d.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new d(t.ɵɵinject("ApiDomain"))},token:d,providedIn:"root"}),d.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],d.ctorParameters=function(){return[{type:o.BehaviorSubject,decorators:[{type:t.Inject,args:["ApiDomain"]}]}]};var u=function(){function e(e,t){this.http=e,this.config=t}return e.prototype.get=function(e,t,o){return void 0===t&&(t=!0),void 0===o&&(o={}),e=t?this.config.url+this.config.prefix+this.config.versionModule+e:this.config.url+e,this.http.get(e,{headers:o.headers,params:o.params}).pipe(n.retry(3))},e.prototype.put=function(e,t,o){return void 0===o&&(o=!0),e=o?this.config.url+this.config.prefix+this.config.versionModule+e:this.config.url+e,this.http.put(e,t)},e.prototype.post=function(e,t,o,r){return void 0===o&&(o=!0),void 0===r&&(r={}),e=o?this.config.url+this.config.prefix+this.config.versionModule+e:this.config.url+e,this.http.post(e,t,{headers:r.headers,params:r.params})},e}();u.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new u(t.ɵɵinject(r.HttpClient),t.ɵɵinject(d))},token:u,providedIn:"root"}),u.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],u.ctorParameters=function(){return[{type:r.HttpClient},{type:d}]};var a=function(){function e(){this.initTypeStorage(),this.event=new o.BehaviorSubject({})}return e.prototype.initTypeStorage=function(){},e.prototype.get=function(e,t){return this[e].get(t)},e.prototype.set=function(e,t,o){return this[e].set(t,o)},e.prototype.sub=function(e,t){var o=this;return this[e].observe().subscribe((function(e){e.key==t&&o.event.next({changeKey:t})})),this.event},e}();a.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new a},token:a,providedIn:"root"}),a.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],a.ctorParameters=function(){return[]};var v="gf:tkn:v2",c=function(){function e(e,t){this.eventer=e,this.state=t}return e.prototype.intercept=function(e,t){var o=this,s=localStorage.getItem(v);return t.handle(s?e.clone({headers:e.headers.set("Authorization","JWT "+s)}):e).pipe(n.filter((function(e){return!!e.type})),n.map((function(e){var t,n,s,l;if(console.log("event---\x3e>>",e),e instanceof r.HttpResponse&&e.ok&&(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.message)&&(null===(s=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.message)||void 0===s?void 0:s.body)){var d=null===(l=null==e?void 0:e.body)||void 0===l?void 0:l.message;o.eventer.emitMessageEvent(new i((null==d?void 0:d.type)||"",(null==d?void 0:d.title)||"",(null==d?void 0:d.body)||""))}return e})),n.catchError((function(e){return o.handleError(e)})))},e.prototype.handleError=function(e){var t,r,n,s,l,d,u,a,c,p,f,g,h,y,m,b,j;if((null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.enable)&&(null===(r=null==e?void 0:e.error)||void 0===r?void 0:r.title)&&(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.description)&&(null===(s=null==e?void 0:e.error)||void 0===s?void 0:s.startDate)&&(null===(l=null==e?void 0:e.error)||void 0===l?void 0:l.stopDate)){var w=(new Date).getTime(),I=new Date(null===(d=null==e?void 0:e.error)||void 0===d?void 0:d.startDate).getTime(),E=new Date(null===(u=null==e?void 0:e.error)||void 0===u?void 0:u.stopDate).getTime();return w>I&&w<E&&this.state.maintenance$.next({title:e.error.title,description:e.error.description,social:e.error.social}),o.throwError(e.error)}switch(!0){case(null==e?void 0:e.error)instanceof ErrorEvent:return console.error("An error occurred:",null===(a=null==e?void 0:e.error)||void 0===a?void 0:a.message),o.throwError(null==e?void 0:e.error);case"timeout-or-duplicate"==(null===(c=e.error)||void 0===c?void 0:c.message):return console.error("An error occurred:",null==e?void 0:e.message),o.throwError("Ошибка сервера (таймаут). Повторите попытку позже");case"timeout-or-duplicate"!=(null===(p=e.error)||void 0===p?void 0:p.message):return console.error("Backend returned code "+(null==e?void 0:e.status)+", body was: ",null==e?void 0:e.error),404==e.status&&(null===(f=null==e?void 0:e.url)||void 0===f?void 0:f.includes("images"))&&((null===(g=null==e?void 0:e.url)||void 0===g?void 0:g.includes(".jpg"))||(null===(h=null==e?void 0:e.url)||void 0===h?void 0:h.includes("png")))||this.eventer.emitMessageEvent(new i("error",(null===(m=null===(y=null==e?void 0:e.error)||void 0===y?void 0:y.message)||void 0===m?void 0:m.title)||"",(null===(j=null===(b=null==e?void 0:e.error)||void 0===b?void 0:b.message)||void 0===j?void 0:j.body)||"")),(401==(null==e?void 0:e.status)||404==(null==e?void 0:e.status)&&"User not found"==(null==e?void 0:e.error))&&(console.log("очистка Storage"),localStorage.removeItem(v)),o.throwError(null==e?void 0:e.error);default:return o.throwError(null==e?void 0:e.error)}},e}();c.decorators=[{type:t.Injectable}],c.ctorParameters=function(){return[{type:s},{type:l}]};var p=function(){function e(e,t){this.eventer=e,this.state=t}return e.prototype.intercept=function(e,t){var o=this;return t.handle(e).pipe(n.map((function(e){var t,n,s,l,d,u,a;if(e instanceof r.HttpResponse&&(null===(t=e.body)||void 0===t?void 0:t.enable)&&void 0!==e.body.title&&void 0!==e.body.description&&void 0!==e.body.startDate&&void 0!==e.body.stopDate){var v=(new Date).getTime(),c=new Date(e.body.startDate).getTime(),p=new Date(e.body.stopDate).getTime();v>c&&v<p&&o.state.maintenance$.next({title:e.body.title,description:e.body.description})}else e instanceof r.HttpResponse&&(null===(s=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.message)||void 0===s?void 0:s.body)&&(null===(d=null===(l=null==e?void 0:e.body)||void 0===l?void 0:l.message)||void 0===d?void 0:d.title)&&(null===(a=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.message)||void 0===a?void 0:a.type)&&o.eventer.emitMessageEvent(new i(e.body.message.type,e.body.message.title,e.body.message.body));return e})))},e}();p.decorators=[{type:t.Injectable}],p.ctorParameters=function(){return[{type:s},{type:l}]};var f=function(){};f.decorators=[{type:t.NgModule,args:[{imports:[],declarations:[],providers:[],exports:[]}]}],e.Config=d,e.EventMessage=i,e.EventerService=s,e.MessageInterceptor=p,e.NetService=u,e.NgCoreModule=f,e.RestoStorageService=a,e.ServerErrorInterceptor=c,e.StateService=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=webresto-ng-core.umd.min.js.map